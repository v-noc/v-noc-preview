{
  "id": "nodes/48886d8a-079b-47bd-94b9-645830fcd748",
  "name": "find_dependencies",
  "node_type": "function",
  "qname": "Jarvis.formats.fasten.Fasten.find_dependencies",
  "file_path": "/Users/yared/Documents/Programing/personal/pythonJaRvis.github.io/Jarvis/tool/Jarvis/formats/fasten.py",
  "file_name": "fasten",
  "code": "def find_dependencies(self, package_path):\n    \"\"\"ID: 48886d8a-079b-47bd-94b9-645830fcd748\"\"\"\n    res = []\n    if not package_path:\n        return res\n    requirements_path = os.path.join(package_path, \"requirements.txt\")\n\n    if not os.path.exists(requirements_path):\n        return res\n\n    reqs = []\n    with open(requirements_path, \"r\") as f:\n        lines = [l.strip() for l in f.readlines()]\n\n    for line in lines:\n        if not line:\n            continue\n\n        req = Requirement.parse(line)\n\n        product = req.unsafe_name\n        specs = req.specs\n\n        constraints = []\n\n        def add_range(begin, end):\n            \"\"\"ID: 735bd0b2-9158-4a62-a018-278ab531a12c\"\"\"\n            if begin and end:\n                if begin[1] and end[1]:\n                    constraints.append(\"[{}..{}]\".format(begin[0], end[0]))\n                elif begin[1]:\n                    constraints.append(\"[{}..{})\".format(begin[0], end[0]))\n                elif end[1]:\n                    constraints.append(\"({}..{}]\".format(begin[0], end[0]))\n                else:\n                    constraints.append(\"({}..{})\".format(begin[0], end[0]))\n            elif begin:\n                if begin[1]:\n                    constraints.append(\"[{}..]\".format(begin[0]))\n                else:\n                    constraints.append(\"({}..]\".format(begin[0]))\n            elif end:\n                if end[1]:\n                    constraints.append(\"[..{}]\".format(end[0]))\n                else:\n                    constraints.append(\"[..{})\".format(end[0]))\n\n        begin = None\n        end = None\n        for key, val in sorted(specs, key=lambda x: x[1]):\n            # if begin, then it is already in a range\n            if key == \"==\":\n                if begin and end:\n                    add_range(begin, end)\n                    begin = None\n                    end = None\n                if not begin:\n                    constraints.append(\"[{}]\".format(val))\n\n            if key == \">\":\n                if end:\n                    add_range(begin, end)\n                    end = None\n                    begin = None\n                if not begin:\n                    begin = (val, False)\n            if key == \">=\":\n                if end:\n                    add_range(begin, end)\n                    begin = None\n                    end = None\n                if not begin:\n                    begin = (val, True)\n\n            if key == \"<\":\n                end = (val, False)\n            if key == \"<=\":\n                end = (val, True)\n        add_range(begin, end)\n\n        res.append(\n            {\"forge\": \"PyPI\", \"product\": req.name, \"constraints\": constraints}\n        )\n\n    return res\n",
  "position": {
    "line_no": 75,
    "col_offset": 4,
    "end_line_no": 160,
    "end_col_offset": 0
  }
}