{
  "id": "nodes/5d6c8071-4447-453d-b387-229721eb6bc7",
  "name": "callgraph",
  "node_type": "file",
  "qname": "Jarvis.machinery.callgraph",
  "file_path": "/Users/yared/Documents/Programing/personal/pythonJaRvis.github.io/Jarvis/tool/Jarvis/machinery/callgraph.py",
  "file_name": "callgraph",
  "code": "# Copyright [pythonJaRvis] [name of copyright owner]\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\"\"\"FileID: 5d6c8071-4447-453d-b387-229721eb6bc7\"\"\"\nimport re\nimport utils\n\nIF_FLAG = \"<if\"\nWHILE_FLAG = \"<while\"\nELSE_FLAG = \"<els\"\nCOPY_FLAG = \"<copy\"\nLIST_FLAG = \"<list\"\nDICT_FLAG = \"<dict\"\n\n\nclass CallGraph(object):\n    \"\"\"ID: c178cd0c-e2b6-490a-8ab9-5ff83ef4185f\"\"\"\n    def __init__(self):\n        \"\"\"ID: 4e656e3a-cd6c-4914-9483-cf8366b92e7b\"\"\"\n        self.cg = {}\n        self.modnames = {}\n\n    def add_node(self, name, modname=\"\"):\n        \"\"\"ID: e234dd61-fe33-4ef0-ae4b-c5ba90dafcc4\"\"\"\n        if not isinstance(name, str):\n            raise CallGraphError(\"Only string node names allowed\")\n        if not name:\n            return\n            raise CallGraphError(\"Empty node name\")\n\n        if not name in self.cg:\n            self.cg[name] = set()\n            self.modnames[name] = modname\n\n        if name in self.cg and not self.modnames[name]:\n            self.modnames[name] = modname\n\n    def add_edge(self, src, dest):\n        \"\"\"ID: f611873f-315e-400b-bde4-716fb04028f4\"\"\"\n        if not src:\n            return\n        def process_str(s: str):\n            \"\"\"ID: 765b94b5-f41f-46db-82ea-a0933c14fda3\"\"\"\n            if IF_FLAG in s or ELSE_FLAG in s or WHILE_FLAG in s or LIST_FLAG in s or DICT_FLAG in s:\n                s_list = s.split(\".\")\n                s_list = list(map(lambda x: None if IF_FLAG in x or ELSE_FLAG in x or WHILE_FLAG in x or LIST_FLAG in x\n                or DICT_FLAG in x else x, s_list))\n                s_list = list(filter(lambda x:x,s_list))\n                return \".\".join(s_list)\n            else:\n                return s\n        if utils.constants.RETURN_NAME in src or utils.constants.RETURN_NAME in dest:\n            return\n        src = process_str(src)\n        dest = process_str(dest)\n        if dest == '<str>':\n            return\n        if dest == '<int>':\n            return\n        # print(src,\"\u8c03\u7528\u4e86\",dest)\n        self.add_node(src)\n        self.add_node(dest)\n        self.cg[src].add(dest)\n\n    def add_edges(self,src,destList):\n        \"\"\"ID: 3ece3248-0134-4199-8f7a-03b2b931ce53\"\"\"\n        self.add_node(src)\n        for dest in destList:\n            self.add_node(dest)\n            self.cg[src].add(dest)\n    def is_exist_edge(self, src, dst):\n        \"\"\"ID: 2898bc8d-f441-414c-9330-a5171b24516a\"\"\"\n        if not src in self.cg:\n            return False\n        return dst in self.cg[src]\n\n    def get(self):\n        \"\"\"ID: 8db4e6a1-97b4-4670-b2a9-b9998a568883\"\"\"\n        return self.cg\n\n    def existEdge(self,src):\n        \"\"\"ID: 2c5f7e49-c37d-4563-8734-6d3138866918\"\"\"\n        if src in self.cg and self.cg[src]:\n            return True\n        return False\n\n    def get_edges(self):\n        \"\"\"ID: a51341c6-b584-4413-98ab-3feee3dc4675\"\"\"\n        output = []\n        for src in self.cg:\n            for dst in self.cg[src]:\n                output.append([src, dst])\n        return output\n\n    def get_modules(self):\n        \"\"\"ID: 8cbc322e-cfc5-4c19-a5a3-ccceec38c401\"\"\"\n        return self.modnames\n\n\nclass CallGraphError(Exception):\n    \"\"\"ID: 0a506f69-933a-4c88-8d60-f9e421b562c8\"\"\"\n    pass\n"
}