{
  "id": "nodes/e4a15a9d-da3a-440b-afc1-b1c203bf933f",
  "name": "_visit_assign",
  "node_type": "function",
  "qname": "Jarvis.processing.extProcessor.ExtProcessor._visit_assign",
  "file_path": "/Users/yared/Documents/Programing/personal/pythonJaRvis.github.io/Jarvis/tool/Jarvis/processing/extProcessor.py",
  "file_name": "extProcessor",
  "code": "def _visit_assign(self, value, targets, row=0):\n    \"\"\"ID: e4a15a9d-da3a-440b-afc1-b1c203bf933f\"\"\"\n    # \u5148\u6267\u884c\u53f3\u8fb9\n    self.visit(value)\n    decoded = self.decode_node(value)\n\n    def assign(xList, y):\n        \"\"\"ID: 12af2b2f-64ed-4767-a08b-d9d4f68bb4c5\"\"\"\n        for x in xList:\n            x_defi = None\n            if isinstance(x, str):\n                x_defi: Definition = self.get_or_create(\n                    self.current_ns,\n                    x[len(self.current_ns) + 1:],\n                    utils.constants.NAME_DEF,\n                )\n            elif isinstance(x, Definition):\n                x_defi = x\n            if not x_defi:\n                return\n            curNsDefi: Definition = self.def_manager.get(self.current_ns)\n            try:\n                iter(decoded)\n            except TypeError:\n                return\n            if not y:\n                y_point = []\n            else:\n                y_point = self.getYPOint(row, y)\n            if curNsDefi.get_type() not in [\n                utils.constants.IF_DEF,\n                utils.constants.WHILE_DEF,\n                utils.constants.ELSE_DEF,\n            ]:\n                x_defi.add_value_point(row, y_point)\n            else:\n                if self.iSDefiInScope(x_defi.get_ns(), self.current_ns):\n                    x_defi.add_value_point(row, y_point)\n                else:\n                    self.change_manager.addChange(\n                        self.current_ns, x_defi.get_ns(), row, y_point\n                    )\n        pass\n\n    def store(xList, f, y):\n        \"\"\"ID: 5ac15501-7739-465d-ab2a-a8d46fbf1f12\"\"\"\n        curScope: ScopeItem = self.scope_manager.get_scope(self.current_ns)\n        xPointList = self.getYPOint(row, xList)\n        y_point = self.getYPOint(row, y)\n        for x in xPointList:\n            if (\n                    curScope.get_def(x)\n                    and curScope.get_def(x).get_type() == utils.constants.NAME_DEF\n            ):\n                curScope.get_def(x).add_value_point(row, y_point)\n            else:\n                self.change_manager.addChange(\n                    self.current_ns, utils.join_ns(x, f), row, y_point\n                )\n                defi: Definition = self.def_manager.get(\n                    utils.join_ns(x, f))\n                if defi:\n                    defi.add_value_point(row, y_point)\n        pass\n\n    def do_assign(decoded, target):\n        \"\"\"ID: ce075edb-58d3-4c12-8ffd-2ef84e23ec4d\"\"\"\n        self.visit(target)\n        try:\n            iter(decoded)\n        except TypeError:\n            return\n        # decoded = list(filter(lambda x: x is not None, decoded))\n        if isinstance(target, ast.Tuple):\n            for pos, elt in enumerate(target.elts):\n                if not isinstance(decoded, Definition) and pos < len(decoded):\n                    do_assign(decoded[pos], elt)\n        else:\n            if isinstance(target, ast.Name):\n                curNsDefi: Definition = self.def_manager.get(\n                    self.current_ns)\n                if curNsDefi.get_type() not in [\n                    utils.constants.IF_DEF,\n                    utils.constants.WHILE_DEF,\n                    utils.constants.ELSE_DEF,\n                ]:\n                    assign(self._get_target_ns(target), decoded)\n                else:\n                    leftTarget = self.scope_manager.get_def(\n                        self.current_ns, target.id\n                    )\n                    if not leftTarget:\n                        leftTargetNs = utils.join_ns(\n                            self.current_ns, target.id)\n                        leftTargetDefi = self.def_manager.create(\n                            leftTargetNs, utils.constants.NAME_DEF\n                        )\n                        self.scope_manager.handle_assign(\n                            self.current_ns, target.id, leftTargetDefi\n                        )\n                    assign(self.decode_node(target), decoded)\n            elif isinstance(target, ast.Attribute):\n                store(self.decode_node(target.value), target.attr, decoded)\n            elif isinstance(target, ast.Subscript):\n                decoded = self.flatten(decoded)\n                decoded = list(filter(lambda x: x is not None, decoded))\n                # leftList = self.getYPOint(target.lineno,self._get_target_ns(target.value))\n                leftList = self.getYPOint(\n                    target.lineno, self.decode_node(target.value))\n\n                # left = self.getYPOint(row,self.decode_node(target.value))\n                for left in leftList:\n                    leftDefi: Definition = self.def_manager.get(left)\n                    if not leftDefi or leftDefi.get_type() not in [utils.constants.LIST_DEF,\n                                                                   utils.constants.MAP_DEF]:\n                        continue\n                    if getattr(target.slice, \"value\", None) is not None and self._is_literal(target.slice.value):\n                        sl_names = [target.slice.value]\n                    else:\n                        # sl_names = self.decode_node(target.slice)\n                        sl_names = self.decode_node(target.value)\n                    keys = set()\n                    for s in sl_names:\n                        if isinstance(s, Definition):\n                            keys.add(s.get_ns())\n                        elif isinstance(s, str):\n                            keys.add(s)\n                        elif isinstance(s, int):\n                            keys.add(s)\n                    for key in keys:\n                        for x in decoded:\n                            if not x:\n                                print()\n                        leftDefi.set_element(key, list(\n                            map(lambda x: x.get_ns() if isinstance(x, Definition) else x, decoded)))\n\n    for target in targets:\n        do_assign(decoded, target)\n",
  "position": {
    "line_no": 520,
    "col_offset": 4,
    "end_line_no": 658,
    "end_col_offset": 0
  }
}