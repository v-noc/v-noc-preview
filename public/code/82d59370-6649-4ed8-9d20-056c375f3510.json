{
  "id": "nodes/82d59370-6649-4ed8-9d20-056c375f3510",
  "name": "DefinitionManager",
  "node_type": "class",
  "qname": "Jarvis.machinery.definitions.DefinitionManager",
  "file_path": "/Users/yared/Documents/Programing/personal/pythonJaRvis.github.io/Jarvis/tool/Jarvis/machinery/definitions.py",
  "file_name": "definitions",
  "code": "class DefinitionManager(object):\n    \"\"\"ID: 82d59370-6649-4ed8-9d20-056c375f3510\"\"\"\n    def __init__(self):\n        \"\"\"ID: 5c70c66b-dcee-49be-a3ce-57eb8a7283e4\"\"\"\n        self.defs = {}\n        self.copyMap = {}\n    # \u521b\u5efa\u4e00\u4e2adef_type\u7c7b\u578b\u7684ns defi\n    def create(self, ns, def_type):\n        \"\"\"ID: e0138cd5-0e34-4106-b174-c78c4e9e545d\"\"\"\n        if not ns or not isinstance(ns, str):\n            raise DefinitionError(\"Invalid namespace argument\")\n        if def_type not in Definition.types:\n            raise DefinitionError(\"Invalid def type argument\")\n        if self.get(ns):\n            raise DefinitionError(\"Definition already exists\")\n        self.defs[ns] = Definition(ns, def_type)\n\n        return self.defs[ns]\n\n    def create_by_name(self,dict_name,ns, def_type):\n        \"\"\"ID: fcc8f219-bc94-49b1-94dd-f2aeb72dff46\"\"\"\n        if not ns or not isinstance(ns, str):\n            raise DefinitionError(\"Invalid namespace argument\")\n        if def_type not in Definition.types:\n            raise DefinitionError(\"Invalid def type argument\")\n        if self.get(dict_name):\n            raise DefinitionError(\"Definition already exists\")\n        self.defs[dict_name] = Definition(ns, def_type)\n\n        return self.defs[dict_name]\n\n\n    def get(self, ns) :\n        \"\"\"ID: ca3b7d8f-93c5-45a7-bde7-b214e13c0d53\"\"\"\n        if ns in self.defs:\n            return self.defs[ns]\n        return None\n\n    def addCopy(self,copyNs,ns):\n        \"\"\"ID: 53c64373-4daf-4ed3-8cef-de23ff02fcbd\"\"\"\n        copyDefi = self.defs.get(copyNs)\n        copyDefi.isCopy = True\n        self.copyMap[copyNs] = ns\n    def getOrCreate(self, ns, def_type):\n        \"\"\"ID: 422f0a42-25a3-418c-8ffb-ffe004bfb445\"\"\"\n        if not self.get(ns):\n            return self.create(ns, def_type)\n\n    def get_defs(self):\n        \"\"\"ID: 4d787d1a-2253-4e2c-b1c9-b6c6a79434af\"\"\"\n        return self.defs\n\n    def handle_function_def(self, parent_ns, fn_name):\n        \"\"\"ID: bbb264c7-e418-4010-ad27-4009b4fe0cd9\"\"\"\n        full_ns = utils.join_ns(parent_ns, fn_name)\n        defi = self.get(full_ns)\n        if not defi:\n            defi = self.create(full_ns, utils.constants.FUN_DEF)\n            defi.decorator_names = set()\n        else:\n            defi.decorator_names = set()\n        defi.def_type = utils.constants.FUN_DEF\n        return_ns = utils.join_ns(full_ns, utils.constants.RETURN_NAME)\n        if not self.get(return_ns):\n            self.create(return_ns, utils.constants.RETURN_DEF)\n\n        return defi\n\n    def handle_class_def(self, parent_ns, cls_name,cls_ns):\n        \"\"\"ID: 9e371152-8a79-470c-b9f7-e65f1554ad79\"\"\"\n        full_ns = utils.join_ns(cls_ns, cls_name)\n        defi: Definition = self.get(full_ns)\n        if not defi:\n            defi = self.create(full_ns, utils.constants.CLS_DEF)\n        else:\n            defi.def_type = utils.constants.CLS_DEF\n        return defi\n\n    def handle_if_def(self, parent_ns, if_name,def_type = utils.constants.IF_DEF):\n        \"\"\"ID: fa6f5e5b-a1e0-43cb-8bcd-d33ced206630\"\"\"\n        full_ns = utils.join_ns(parent_ns, if_name)\n        defi = self.get(full_ns)\n        if not defi:\n            defi = self.create(full_ns,def_type)\n        return defi\n\n    def transform_defi(self, ns, row) -> list:\n        \"\"\"ID: bd8b8a39-013f-4fcb-98e6-1423c4b97cef\"\"\"\n        defi: Definition = self.defs.get(ns)\n        transDefiNames = []\n        for point_ns in defi.get_name_pointer(row):\n            transDefiNames.append(point_ns)\n        return transDefiNames\n\n    def get_final_pointName(self, defiNs, row):\n        \"\"\"ID: 9d3ee7ce-f152-473f-af3c-52ff9a322340\"\"\"\n        curDefi: Definition = self.get(defiNs)\n        if not curDefi:\n            return [defiNs], row\n        if not curDefi.points:\n            return [defiNs], row\n        # pointItem: PointItem = curDefi.get_point(row)\n        pointValues:set() = curDefi.get_last_point_value()\n        if not pointValues:\n            pointValues = curDefi.get_last_point_value()\n            if not pointValues:\n                return [defiNs],row\n        return pointValues,row\n\n    def get_scope_name(self, ns: str):\n        \"\"\"ID: 2ba11a01-d630-4c46-a5f7-ff485df567c6\"\"\"\n        while ns.rfind('.') != -1:\n            rIndex = ns.rfind('.')\n            scopeNs = ns[:rIndex]\n            if self.get(scopeNs) and self.get(scopeNs).get_type() in [utils.constants.MOD_DEF,\n                                                                      utils.constants.CLS_DEF,\n                                                                      utils.constants.FUN_DEF,\n                                                                      ]:\n                return scopeNs\n            ns = scopeNs\n\n    def get_module_name(self, ns: str):\n        \"\"\"ID: b0d273f3-df4b-4883-bf04-7c1bd6023dad\"\"\"\n        while ns.rfind('.') != -1:\n            rIndex = ns.rfind('.')\n            moduleNs = ns[:rIndex]\n            if self.get(moduleNs) and self.get(moduleNs).get_type() == utils.constants.MOD_DEF:\n                return moduleNs\n            ns = moduleNs\n\n    def is_same_scope(self, first, second):\n        \"\"\"ID: 73513dd8-84f4-46eb-ae0e-c6ed634cb097\"\"\"\n        return self.get_scope_name(first) == self.get_scope_name(second)\n\n    def helper(self, defiNs, row):\n        \"\"\"ID: 1a337601-8d3c-4df5-abc2-c91c441aa729\"\"\"\n        curDefi: Definition = self.get(defiNs)\n        if not curDefi:\n            return defiNs\n        if not curDefi.points:\n            return defiNs\n\n    def get_last_final_pointName(self, defiNs) -> list:\n        \"\"\"ID: 7cead2d5-c022-41c3-8165-e78ec4419b3f\"\"\"\n        queue = [defiNs]\n        finalDefiNsList = []\n        while queue:\n            curDefiNs = queue[0]\n            queue.remove(curDefiNs)\n            curDefi: Definition = self.get(curDefiNs)\n            curItemLists = curDefi.get_last_point_value()\n            if not curItemLists:\n                finalDefiNsList.append(curDefiNs)\n            else:\n                queue += curItemLists\n        return finalDefiNsList\n",
  "position": {
    "line_no": 43,
    "col_offset": 0,
    "end_line_no": 199,
    "end_col_offset": 0
  }
}